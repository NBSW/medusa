<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">

    ##     <!-- 新 Bootstrap 核心 CSS 文件 -->
    ##     <link rel="stylesheet" href="/static/bootstrap/bootstrap.min.css">
    ##     <!-- 可选的Bootstrap主题文件（一般不用引入） -->
    ##     <link rel="stylesheet" href="/static/bootstrap/bootstrap-theme.min.css">
    ##     <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    ##     <script src="/static/bootstrap/jquery.min.js"></script>
    ##     <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    ##     <script src="/static/bootstrap/bootstrap.min.js"></script>
    ##     <!-- jsTree -->
    ##     <link rel="stylesheet" href="/static/jstree/themes/default/style.min.css" />
    ##     <script src="/static/jstree/jquery.min.js"></script>
    ##     <script src="/static/jstree/jstree.min.js"></script>
    ##     <!-- echarts -->
    ##     <script src="/static/echarts/echarts-all.js"></script>


    ## JS 引用顺序: jquery, underscore, backbone
    <script src="http://the5fireblog.b0.upaiyun.com/staticfile/jquery-1.10.2.js"></script>
    <script src="http://the5fireblog.b0.upaiyun.com/staticfile/underscore.js"></script>
    <script src="http://the5fireblog.b0.upaiyun.com/staticfile/backbone.js"></script>


</head>
<body>
    <h3>backbone.js</h3>

    <div class="container-fluid">
        ## ${ data['key'] }
    </div>

    <div class="container-fluid">
        <table class="table table-bordered table-striped" id="id_table">
            <thead>
                <tr>
                    <td>ID</td>
                    <th>图片</th>
                    <th>标题</th>
                    <th>来源频道</th>
                    <th>详情</th>
                    <th>发布时间</th>
                </tr>
            </thead>
            <tbody>
##                 {% for news in page.object_list %}
##                 <tr>
##                     <td>{{ news.id }}</td>
##                     <td>
##                         <img src="{{ news.img }}" height="120" width="160">
##                     </td>
##                     <td><a href="{{ news.link }}">{{ news.title }}</a></td>
##                     <td>{{ news.source }}<br>{{ news.channel_name }}({{ news.channel_id }})</td>
##                     <td>{{ news.desc }}</td>
##                     <td>{{ news.datetime_publish }}</td>
##                 </tr>
##                 {% endfor %}
            </tbody>
        </table>
    </div>




    <script>
        (function($){
            var News = Backbone.Model.extend({
                // url: "http://192.168.100.100:8000/api/news/?format=json",
                url: "/api/news/?format=json",
                initialize: function(){
                    // alert('[News] Created');
                    console.log('[News] Created');
                    // 初始化时绑定监听
                    this.bind("change:name", function(){
                        var name = this.get('name');
                        // alert("You changed attribute name = " + name);
                        console.log("You changed attribute : name=" + name);
                    });
                    // 为对象添加验证规则和错误提示
                    this.bind("invalid",function(model,error){
                        // alert(model);
                        alert(error);
                    });
                },
                defaults: {
                    'name': 'Tony',
                    'age': '35'
                },
                validate: function(attributes){
                    if(attributes.name == ''){
                        return 'name can NOT be blank !!!'
                    }
                },
                info: function(){
                    return 'My Name is ' + this.get('name') + ', My Age is' + this.get('age');
                }
            });


            var news = new News();
            //alert(news.info());
            console.log(news.info());
            //触发绑定的change事件, alert
            news.set({'name': 'Clark'});
            //触发绑定的change事件, alert
            news.set({'name': 'Bruce'});
            //触发绑定的change事件, alert
            //默认set时不进行验证
            news.set({'name': ''});
            //触发绑定的change事件, alert
            //手动触发验证, set时会触发
            news.set({'name': ''}, {'validate':true});


            var news = new News();
            news.fetch({
                success: function(model, response){
                    alert('fetch success');
                    //response为获取到的数据
                    console.log(model);
                    console.log(response);
                    //alert(response['results'][0]['title']);
                },
                error: function(){
                    alert('fetch error');
                }
            });


        })(jQuery);
    </script>




    <script>
##         var News = Backbone.Model.extend({
##             url: "http://192.168.100.100:8000/api/news/?format=json",
##             parse: function(response) {
##                 // alert(response);
##                 console.log(response);
##                 return (response[0]);
##             }
##         });
##         var news = new News();
##
##         news.on('change', function(model) {
##             var table = document.getElementById("id_table");
##             var thead = table.children[0];
##             console.log(thead);
##             var tbody = table.children[1];
##             console.log(tbody);
##             var tr = document.getelementbyid(model.get("id"));
##             if (!tr) {
##                 tr = document.createElement('tr');
##                 tr.setAttribute('id', model.get('id'));
##                 tr.innerHTML = '<td>' + model.get('title') + '</td>';
##                 tbody.appendChild(tr);
##             }
##         });
##
##         news.fetch();
    </script>

</body>
</html>
